<MudDialog>
    <TitleContent>
        <MudText>Add new league</MudText>
    </TitleContent>
    <DialogContent>
        <MudForm Model="@model">
            <MudTextField T="string" @bind-Value="model.Name" Label="Name" />
            @* NOTE: Editable range table could deserve it's own file *@
            <RangeInput Items="_skillRanges" RangeType="RangeType.Skill">Skill</RangeInput>
            <RangeInput Items="_ageRanges" RangeType="RangeType.Age">Age</RangeInput>
            <RangeInput Items="_teamRanges" RangeType="RangeType.Team">Team</RangeInput>
            <RangeInput Items="_engineRanges" RangeType="RangeType.Engine">Engine</RangeInput>
        </MudForm>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">Cancel</MudButton>
        <MudButton Color="Color.Primary" OnClick="Submit">Ok</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter]
    protected MudDialogInstance? LeagueDialog { get; set; }

    [Parameter]
    public League? League { get; set; }

    private EditLeagueModel model = new();
    private List<EditDevRangeModel> _skillRanges = new();
    private List<EditDevRangeModel> _ageRanges = new();
    private List<EditDevRangeModel> _teamRanges = new();
    private List<EditDevRangeModel> _engineRanges = new();

    //private string[] dropZones = new[] { "Skill", "Age", "Team", "Engine" };

    protected override void OnInitialized()
    {
        if (League != null)
        {
            model = new EditLeagueModel(League);
            _skillRanges = model.DevelopmentRanges.Where(e => e.Type == RangeType.Skill).ToList();
            _ageRanges = model.DevelopmentRanges.Where(e => e.Type == RangeType.Age).ToList();
            _teamRanges = model.DevelopmentRanges.Where(e => e.Type == RangeType.Team).ToList();
            _engineRanges = model.DevelopmentRanges.Where(e => e.Type == RangeType.Engine).ToList();
        }
    }

    private void AppendSkillRangeRow()
    {
        var newRange = new EditDevRangeModel
            {
                Type = RangeType.Skill,
                Comparer = 1,
                Minimum = -2,
                Maximum = 2,
                LeagueId = model.Id
            };

        model.DevelopmentRanges.Add(newRange);
    }

    private void Submit()
    {
        var allRanges = new List<EditDevRangeModel>();
        allRanges.AddRange(_skillRanges);
        allRanges.AddRange(_ageRanges);
        allRanges.AddRange(_teamRanges);
        allRanges.AddRange(_engineRanges);

        model.DevelopmentRanges = allRanges;

        if (model.IsDirty)
        {
            var modLeague = model.Record;

            LeagueDialog?.Close(DialogResult.Ok(modLeague));
        }
    }

    private void Cancel() => LeagueDialog?.Cancel();
}
