<MudContainer MaxWidth="MaxWidth.Medium">
    <MudPaper MinHeight="60px">
        <MudStack Row="true" AlignItems="AlignItems.Center" Class="pa-4">
            <MudText Typo="Typo.h3">Engines</MudText>
            <MudSpacer />
            <MudButton Variant="Variant.Outlined" Color="Color.Success" StartIcon="@Icons.Material.Outlined.Add" OnClick="EnterEngine">New</MudButton>
        </MudStack>
    </MudPaper>
    <MudDataGrid T="SeasonEngine" Items="@EngineEntrants" Dense="true">
        <Columns>
            <PropertyColumn Property="e => e!.Name" />
            <PropertyColumn Property="e => e!.Power" />
            <PropertyColumn Property="e => e!.Reliability" Title="REL" />
            <PropertyColumn Property="e => e!.Rebadged" />
            <TemplateColumn T="SeasonEngine" Sortable="false">
                <CellTemplate>
                    <MudButtonGroup>
                        <MudIconButton Size="Size.Small" Icon="@Icons.Material.Outlined.Edit" OnClick="@(async () => await UpdateEngine(context.Item))" />
                    </MudButtonGroup>
                </CellTemplate>
            </TemplateColumn>
        </Columns>
    </MudDataGrid>
</MudContainer>

@code {
    [CascadingParameter] public Season Season { get; set; }
    [Parameter] public IEnumerable<SeasonEngine> EngineEntrants { get; set; } = Enumerable.Empty<SeasonEngine>();
    [Parameter] public EventCallback<SeasonEngine?> OnEditorOpen { get; set; }

    // Warning: this is also triggered when just pressing the button to start editing
    protected override void OnParametersSet()
    {
    }

    async Task EnterEngine() => await UpdateEngine(null);
    async Task UpdateEngine(SeasonEngine? item)
    {
        await OnEditorOpen.InvokeAsync(item);
    }
}
