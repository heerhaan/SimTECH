@page "/components/{SeasonId:long}"
@inject BreadcrumbProvider _bread
@inject SeasonService _seasonService

<PageTitle>Components</PageTitle>

<MudContainer>
    @if (PartsPerDriver != null)
    {
        <MudGrid>
            <MudItem xs="9">
                <MudPaper Class="mud-height-full">
                    <MudTable Items="@PartsPerDriver">
                        <ToolBarContent>
                            <MudText Typo="Typo.h4">Components</MudText>
                        </ToolBarContent>
                        <HeaderContent>
                            <MudTh>Name</MudTh>
                            <MudTh Class="pa-0">No</MudTh>
                            <MudTh>Accidents</MudTh>
                            <MudTh>Collisions</MudTh>
                            <MudTh>Engines</MudTh>
                            <MudTh>Electrics</MudTh>
                            <MudTh>Hydraulics</MudTh>
                            <MudTh>DNF</MudTh>
                            <MudTh>DSQ</MudTh>
                        </HeaderContent>
                        <RowTemplate>
                            <MudTd>
                                <MudText>@context.Name</MudText>
                            </MudTd>
                            <MudTd Class="pa-0" Style="@(ViewHelper.SetFullColourstyle(context.Colour, context.Accent))">
                                <MudText Typo="Typo.caption">@context.Number</MudText>
                            </MudTd>
                            <MudTd>
                                <MudText Typo="Typo.caption">@context.Accidents</MudText>
                            </MudTd>
                            <MudTd>
                                <MudText Typo="Typo.caption">@context.Collisions</MudText>
                            </MudTd>
                            <MudTd>
                                <MudText Typo="Typo.caption">@context.Engines</MudText>
                            </MudTd>
                            <MudTd>
                                <MudText Typo="Typo.caption">@context.Electrics</MudText>
                            </MudTd>
                            <MudTd>
                                <MudText Typo="Typo.caption">@context.Hydraulics</MudText>
                            </MudTd>
                            <MudTd>
                                <MudText Typo="Typo.caption">@context.TotalDnf</MudText>
                            </MudTd>
                            <MudTd>
                                <MudText Typo="Typo.caption">@context.TotalDsq</MudText>
                            </MudTd>
                        </RowTemplate>
                        <FooterContent>
                            <MudTd>LIMIT</MudTd>
                            <MudTd>3</MudTd>
                            <MudTd>3</MudTd>
                            <MudTd>3</MudTd>
                            <MudTd>3</MudTd>
                            <MudTd>3</MudTd>
                            <MudTd>-</MudTd>
                            <MudTd>-</MudTd>
                        </FooterContent>
                    </MudTable>
                </MudPaper>
            </MudItem>
            <MudItem xs="3">
                <MudPaper Class="pa-4 mud-height-full">
                    <MudText Typo="Typo.h4">Penalties</MudText>
                    <MudList>
                        @foreach (var driver in PartsPerDriver.Where(e => e.GivenPenalties?.Any() == true))
                        {
                            @foreach (var penalty in driver.GivenPenalties)
                            {
                                <MudListItem>
                                    <MudStack Row="true" Spacing="2" AlignItems="AlignItems.Center">
                                        <MudText Typo="Typo.body2">Round @penalty.Round</MudText>
                                        <MudText>@driver.Name</MudText>
                                        <MudText>+@(penalty.Punishment)</MudText>
                                    </MudStack>
                                </MudListItem>
                            }
                        }
                    </MudList>
                </MudPaper>
            </MudItem>
        </MudGrid>
    }
</MudContainer>

@code {
    [Parameter] public long SeasonId { get; set; }

    List<PartsUsageModel> PartsPerDriver;

    protected override async Task OnInitializedAsync()
    {
        _bread.SetBreadcrumbs(new List<BreadcrumbItem>()
        {
            new BreadcrumbItem("Home", href: "/"),
            new BreadcrumbItem("Seasons", href: "seasons}"),
            new BreadcrumbItem("Overview", href: $"overview/{SeasonId}"),
            new BreadcrumbItem("Components", href: $"components/{SeasonId}", disabled: true),
        });

        PartsPerDriver = await _seasonService.GetPartsUsageModel(SeasonId);
    }
}
