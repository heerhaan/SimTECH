@using static SimTECH.Pages.Season.DevelopmentEntrants;

<MudDialog>
    <TitleContent>
        <MudText>Summary of all the completed developments here!</MudText>
        <MudText Color="Color.Warning">TODO: group entrants with aspect too too</MudText>
    </TitleContent>
    <DialogContent>
        <MudContainer MaxWidth="MaxWidth.False">
            <MudPaper>
                <MudStack Row="true">
                    <ScreenshotButton TargetId="developed-summary" />
                </MudStack>
            </MudPaper>
            <MudPaper MinWidth="800px" id="developed-summary">
                <MudStack Row="true" Class="flex-wrap">
                    @foreach (var entrantGroup in Completed.GroupBy(e => e.EntrantGroup))
                    {
                        <MudPaper Elevation="15">
                            <MudText Typo="Typo.h4">@entrantGroup.Key.ToString()</MudText>

                            @foreach (var development in entrantGroup)
                            {
                                <MudTable Items="@development.Entrants" Dense="true" Class="extra-dense">
                                    <ToolBarContent>
                                        <MudText Typo="Typo.h6">@development.DevelopedAspect.ReadableAspect()</MudText>
                                    </ToolBarContent>
                                    <HeaderContent>
                                        <MudTh>
                                            <MudTableSortLabel T="DevelopedEntrant" SortBy="@(e => e.Name)">
                                                Name
                                            </MudTableSortLabel>
                                        </MudTh>
                                        <MudTh Class="number-col-lg">
                                            <MudTableSortLabel T="DevelopedEntrant" SortBy="@(e => e.Old)">
                                                Old
                                            </MudTableSortLabel>
                                        </MudTh>
                                        <MudTh Class="number-col-lg">
                                            <MudTableSortLabel T="DevelopedEntrant" SortBy="@(e => e.Change)">
                                                Change
                                            </MudTableSortLabel>
                                        </MudTh>
                                        <MudTh Class="number-col-lg">
                                            <MudTableSortLabel T="DevelopedEntrant" SortBy="@(e => e.New)">
                                                New
                                            </MudTableSortLabel>
                                        </MudTh>
                                    </HeaderContent>
                                    <RowTemplate>
                                        <MudTd Style="max-width:200px">
                                            <MudStack Row="true" AlignItems="AlignItems.Center" Class="pa-0">
                                                <MudText Class="overflow-hider">@context.Name</MudText>
                                                <MudSpacer />
                                                @if (context.Nationality.HasValue)
                                                {
                                                    <CountryFlag Code="@context.Nationality.Value" Size="FlagSize.Small" />
                                                }
                                            </MudStack>
                                        </MudTd>
                                        <MudTd Class="number-col-lg">
                                            <MudText Typo="Typo.caption">@context.Old</MudText>
                                        </MudTd>
                                        <MudTd Class="number-col-lg">
                                            <GradientColour Min="@development.MinChange" Max="@development.MaxChange" Value="@context.Change">
                                                <MudText Typo="Typo.caption">@context.Change</MudText>
                                            </GradientColour>
                                        </MudTd>
                                        <MudTd Class="number-col-lg">
                                            <MudText Typo="Typo.caption">@context.New</MudText>
                                        </MudTd>
                                    </RowTemplate>
                                </MudTable>
                            }
                        </MudPaper>
                    }
                </MudStack>
            </MudPaper>
        </MudContainer>
    </DialogContent>
</MudDialog>

@code {
    [CascadingParameter] protected MudDialogInstance? SummaryDialog { get; set; }
    [Parameter, EditorRequired] public List<CompletedDevelopment> Completed { get; set; }
}
