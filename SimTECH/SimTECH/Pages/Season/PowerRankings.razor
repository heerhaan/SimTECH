@inject SeasonService SeasonService

@if (DriverRankings != null)
{
    <MudDataGrid T="PowerRankModel" Items="DriverRankings" Dense="true">
        <ToolBarContent>
            <MudText Typo="Typo.h4">Power rankings</MudText>
        </ToolBarContent>
        <ColGroup>
            <col />
            <col class="number-col" />
            <col />
            <col />
            <col />
            <col />
            <col />
            <col />
            <col />
            <col />
            <col />
        </ColGroup>
        <Columns>
            <TemplateColumn T="PowerRankModel" SortBy="e => e.DriverName" Title="Driver">
                <CellTemplate>
                    <MudText Typo="Typo.body2">
                        <CountryFlag Code="@context.Item.Nationality" Size="FlagSize.Small" />
                        @context.Item.DriverName
                    </MudText>
                </CellTemplate>
            </TemplateColumn>
            <PropertyColumn Property="e => e.DriverNumber" SortBy="e => e.DriverNumber" Title="No." CellClass="number-col" CellStyleFunc="FullStyleFunc" />
            <PropertyColumn Property="e => e.TeamName" Title="Team" CellStyleFunc="@SimpleCellStyle" />
            <PropertyColumn Property="e => e.Engine" />
            <PropertyColumn Property="e => e.Manufacturer" />
            <PropertyColumn Property="e => e.QualyPower" />
            <PropertyColumn Property="e => e.RacePower" />
            <TemplateColumn T="PowerRankModel" Title="A/C/P" Sortable="false">
                <CellTemplate>
                    <MudText Typo="Typo.caption">@context.Item.Aero / @context.Item.Chassis / @context.Item.Powertrain</MudText>
                </CellTemplate>
            </TemplateColumn>
            <TemplateColumn T="PowerRankModel" Title="Reliability [D/T/E]" Sortable="false">
                <CellTemplate>
                    <MudText Typo="Typo.caption">@context.Item.DriverRel / @context.Item.CarRel / @context.Item.EngineRel</MudText>
                </CellTemplate>
            </TemplateColumn>
            <TemplateColumn T="PowerRankModel" Title="Wear" Sortable="false">
                <CellTemplate>
                    <MudText Typo="Typo.caption">@context.Item.WearMax ↔ @context.Item.WearMin</MudText>
                </CellTemplate>
            </TemplateColumn>
            <TemplateColumn T="PowerRankModel" Title="RngMod" Sortable="false">
                <CellTemplate>
                    @if (context.Item.TraitEffect != null)
                    {
                        <MudText Typo="Typo.caption">@context.Item.TraitEffect.MinRNG ↔ @context.Item.TraitEffect.MaxRNG</MudText>
                    }
                </CellTemplate>
            </TemplateColumn>
        </Columns>
    </MudDataGrid>
}

@code {
    [CascadingParameter] public Season Season { get; set; }

    List<PowerRankModel> DriverRankings;

    protected override async Task OnInitializedAsync()
    {
        DriverRankings = await SeasonService.GetPowerRankings(Season.Id);
    }

    private Func<PowerRankModel, string> FullStyleFunc => power => ViewHelper.SetFullColourstyle(power.Colour, power.Accent);

    private Func<PowerRankModel, string> SimpleCellStyle => power => ViewHelper.SetBorderRightStyle(power.Colour);
}
